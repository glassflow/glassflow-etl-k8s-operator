---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.1
  name: pipelines.etl.glassflow.io
spec:
  group: etl.glassflow.io
  names:
    kind: Pipeline
    listKind: PipelineList
    plural: pipelines
    singular: pipeline
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Pipeline is the Schema for the pipelines API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: PipelineSpec defines the desired state of Pipeline.
            properties:
              join:
                properties:
                  enabled:
                    type: boolean
                  sources:
                    items:
                      properties:
                        join_key:
                          minLength: 1
                          type: string
                        orientation:
                          enum:
                          - left
                          - right
                          type: string
                        source_id:
                          minLength: 1
                          type: string
                        time_window:
                          description: |-
                            A Duration represents the elapsed time between two instants
                            as an int64 nanosecond count. The representation limits the
                            largest representable duration to approximately 290 years.
                          format: int64
                          type: integer
                      required:
                      - join_key
                      - orientation
                      - source_id
                      - time_window
                      type: object
                    maxItems: 2
                    minItems: 2
                    type: array
                  type:
                    enum:
                    - temporal
                    type: string
                required:
                - enabled
                - type
                type: object
              kafka_topics:
                properties:
                  kafka_connection_params:
                    properties:
                      brokers:
                        items:
                          type: string
                        minItems: 1
                        type: array
                      mechanism:
                        enum:
                        - SCRAM-SHA-256
                        - SCRAM-SHA-512
                        - PLAIN
                        type: string
                      password:
                        type: string
                      protocol:
                        enum:
                        - SASL_SSL
                        - SSL
                        - SASL_PLAINTEXT
                        - PLAINTEXT
                        type: string
                      root_ca:
                        type: string
                      sasl_tls_enable:
                        type: boolean
                      skip_auth:
                        type: boolean
                      username:
                        type: string
                    required:
                    - brokers
                    - mechanism
                    - password
                    - protocol
                    - root_ca
                    - sasl_tls_enable
                    - username
                    type: object
                  topics:
                    items:
                      properties:
                        consumer_group_initial_offset:
                          enum:
                          - earliest
                          - latest
                          type: string
                        deduplication:
                          properties:
                            enabled:
                              type: boolean
                            id_field:
                              minLength: 1
                              type: string
                            id_field_type:
                              minLength: 1
                              type: string
                            time_window:
                              description: |-
                                A Duration represents the elapsed time between two instants
                                as an int64 nanosecond count. The representation limits the
                                largest representable duration to approximately 290 years.
                              format: int64
                              type: integer
                          required:
                          - enabled
                          type: object
                        name:
                          minLength: 1
                          type: string
                      required:
                      - consumer_group_initial_offset
                      - deduplication
                      - name
                      type: object
                    maxItems: 2
                    minItems: 1
                    type: array
                  type:
                    enum:
                    - kafka
                    type: string
                required:
                - kafka_connection_params
                - topics
                - type
                type: object
              mapper:
                properties:
                  sink_mapping:
                    items:
                      properties:
                        column_name:
                          minLength: 1
                          type: string
                        column_type:
                          minLength: 1
                          type: string
                        field_name:
                          minLength: 1
                          type: string
                        stream_name:
                          minLength: 1
                          type: string
                      required:
                      - column_name
                      - column_type
                      - field_name
                      - stream_name
                      type: object
                    minItems: 1
                    type: array
                  streams:
                    items:
                      properties:
                        name:
                          type: string
                        schema_config:
                          properties:
                            fields:
                              items:
                                properties:
                                  field_name:
                                    minLength: 1
                                    type: string
                                  field_type:
                                    minLength: 1
                                    type: string
                                required:
                                - field_name
                                - field_type
                                type: object
                              type: array
                            join_key_field:
                              minLength: 1
                              type: string
                            join_orientation:
                              enum:
                              - left
                              - right
                              type: string
                            join_window:
                              description: |-
                                A Duration represents the elapsed time between two instants
                                as an int64 nanosecond count. The representation limits the
                                largest representable duration to approximately 290 years.
                              format: int64
                              type: integer
                          required:
                          - fields
                          type: object
                      required:
                      - name
                      - schema_config
                      type: object
                    type: array
                  type:
                    default: jsonToClickhouse
                    type: string
                required:
                - sink_mapping
                - streams
                - type
                type: object
              pipeline_id:
                minLength: 5
                type: string
              sink:
                properties:
                  database:
                    minLength: 1
                    type: string
                  host:
                    minLength: 5
                    type: string
                  max_batch_size:
                    type: integer
                  max_delay_time:
                    description: |-
                      A Duration represents the elapsed time between two instants
                      as an int64 nanosecond count. The representation limits the
                      largest representable duration to approximately 290 years.
                    format: int64
                    type: integer
                  password:
                    type: string
                  port:
                    minLength: 4
                    type: string
                  secure:
                    type: boolean
                  skip_certificate_check:
                    type: boolean
                  table:
                    minLength: 1
                    type: string
                  type:
                    enum:
                    - clickhouse
                    type: string
                  user:
                    type: string
                required:
                - database
                - host
                - max_batch_size
                - max_delay_time
                - password
                - port
                - secure
                - table
                - type
                - user
                type: object
            required:
            - join
            - kafka_topics
            - mapper
            - pipeline_id
            - sink
            type: object
          status:
            description: PipelineStatus defines the observed state of Pipeline.
            properties:
              ingestor_operator_status:
                enum:
                - none
                - started
                - stopped
                type: string
              join_operator_status:
                enum:
                - none
                - started
                - stopped
                type: string
              sink_operator_status:
                enum:
                - none
                - started
                - stopped
                type: string
            required:
            - ingestor_operator_status
            - join_operator_status
            - sink_operator_status
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
